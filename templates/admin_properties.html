<!-- Property Management Section -->
<div class="back-container">
    <div class="button-container">
        
        <button class="button" hx-get="http://localhost:5000/admin-users" hx-target="#dashboard-container" hx-swap="innerHTML" onclick="activateDashboardContainer()">Back</button>
    </div>
</div>
<br>
<br>
<h4 style="text-align: center;" id="value_header">{{header_title}}:Landlord ID:{{front_user_id}}</h4>
<table id="example" class="display" style="width:100%">
    <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Description</th>
            <th>Landlord ID</th>
            
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
        {% for property in properties%}
        <tr id="property-{{property.id}}">
            <td>{{property.id}}</td>
            <td>{{property.name}}</td>
            <td>{{property.description}}</td>
            {% set front_user_id = property.id %}
            <td>{{ front_user_id }}</td>
            
            <td>
                <div class="table-button-container">
                    <a href="" class="table-button" hx-get="http://localhost:5000/admin-property-units/{{property.id}}" hx-target="#dashboard-container" hx-swap="innerHTML" onclick="activateDashboardContainer()">Units</a>
                </div>
                <div class="table-button-container">
                    <button class="table-button" onclick="deleteProperty('{{ property.id }}')">Delete</button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<br>
<br>
<div class="back-container">
    <div class="button-container">
        <button class="button" onclick="loadAddPropertyForm()">Add Property</button>
    </div>
</div>
<div id="dashboard-container" class="dashboard-container">
    <!-- Placeholder for dynamic content, such as the add user form -->
</div>
<script>
    function initializeDataTable() {
        $('#example').DataTable();
    }

    // Initialize DataTable after the page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeDataTable();
    });

    function loadAddPropertyForm() {
    // Get the landlord ID from the element with the id "value_header"
    const headerElement = document.getElementById('value_header');
    const headerText = headerElement.textContent;
    
    // Extract the landlord ID from the header text (assuming format is "val:val2:idval")
    const parts = headerText.split(':');
    const landlordId = parts[2]?.trim();  // Get the 3rd part (index 2) and trim any extra spaces
    
    if (landlordId) {
        console.log(`Landlord ID is: ${landlordId}`);

        // Fetch the form with the landlord ID
        fetch(`/admin-add-property/${landlordId}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-container').innerHTML = html;
            })
            .catch(error => console.error('Error loading add property form:', error));
    } else {
        console.error('Landlord ID not found in the header.');
    }
    }



    
    function deleteProperty(PropertyId){
        if (confirm('Are you sure you want to delete this property?')) {
            
            fetch(`/delete-property/${PropertyId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ property_id: PropertyId })  // Send property ID as JSON
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const row = document.getElementById(`property-${PropertyId}`);
                    row.remove();
                    alert(data.message); // Show success alert
                } else {
                    alert('Error: ' + data.message); // Show error alert
                }
            })
            .catch(error => {
                console.error('Error deleting property:', error);
                alert('An error occurred while trying to delete the property.');
            });
        }
    }
</script>