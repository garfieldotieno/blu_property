<!-- Unit Management Section -->
<div class="back-container">
    <div class="button-container">
        <button class="button" hx-get="http://localhost:5000/admin-user-properties/{{back_user_id}}" hx-target="#dashboard-container" hx-swap="innerHTML" onclick="activateDashboardContainer()">Back</button>
    </div>
</div>
<br>
<br>
<h4 style="text-align: center;" id="value_header">{{header_title}}:Property ID:{{front_property_id}}</h4>
<table id="example" class="display" style="width:100%">
    <thead>
        <tr>
            <th>Id</th>
            <th>Number</th>
            <th>Quantity</th>
            <th>Type</th>
            <th>Description</th>
            <th>Property ID</th>
            <th>Tenant ID</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for unit in units%}
        <tr id="unit-{{unit.id}}">
            <td>{{unit.id}}</td>
            <td>{{unit.number}}</td>
            <td>{{unit.room_quantity}}</td>
            <td>{{unit.unit_type}}</td>
            <td>{{unit.unit_description}}</td>
            <td>{{unit.property_id}}</td>
            <td>{{unit.tenant_id}}</td>
            <td>
                <div class="table-button-container">
                    <a href="" class="table-button" hx-get="http://localhost:5000/admin-unit-leases/{{unit.id}}" hx-target="#dashboard-container" hx-swap="innerHTML" onclick="activateDashboardContainer()">Lease</a>
                </div>
                <div class="table-button-container">
                    <button class="table-button" onclick="deleteUnit('{{ unit.id }}')">Delete</button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<br>
<br>
<div class="back-container">
    <div class="button-container">
        <button class="button" onclick="loadAddUnitForm()">Add Unit</button>
    </div>
</div>
<div id="dashboard-container" class="dashboard-container">
    <!-- Placeholder for dynamic content, such as the add user form -->
</div>
<script>
    function initializeDataTable() {
        $('#example').DataTable();
    }

    // Initialize DataTable after the page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeDataTable();
    });

    function loadAddUnitForm() {
    // Get the property ID from the element with the id "value_header"
    const headerElement = document.getElementById('value_header');
    const headerText = headerElement.textContent;
    
    // Extract the property ID from the header text (assuming format is "val:val2:idval")
    const parts = headerText.split(':');
    const propertyId = parts[2]?.trim();  // Get the 3rd part (index 2) and trim any extra spaces
    
    if (propertyId) {
        console.log(`Property ID is: ${propertyId}`);

        // Fetch the form with the landlord ID
        fetch(`/admin-add-unit/${propertyId}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-container').innerHTML = html;
            })
            .catch(error => console.error('Error loading add unit form:', error));
    } else {
        console.error('property ID not found in the header.');
    }
    }


    function deleteUnit(unitId){
        if (confirm('Are you sure you want to delete this unit?')) {
            fetch(`/delete-unit/${unitId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ unit_id: unitId })  // Send unit ID as JSON
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const row = document.getElementById(`unit-${unitId}`);
                    row.remove();
                    alert(data.message); // Show success alert
                } else {
                    alert('Error: ' + data.message); // Show error alert
                }
            })
            .catch(error => {
                console.error('Error deleting unit:', error);
                alert('An error occurred while trying to delete the unit.');
            });
        }
    }
</script>